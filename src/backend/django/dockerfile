FROM python:3.9

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

VOLUME [ "./src" ]

RUN pip install pipenv
RUN apt-get update && apt-get install -y --no-install-recommends gcc

RUN useradd --create-home appuser
WORKDIR /home/appuser
USER appuser

COPY . .
# RUN PIPENV_VENV_IN_PROJECT=1 pipenv install --system --deploy
RUN pipenv install --dev --system --deploy

RUN python manage.py migrate

EXPOSE 8000

ENTRYPOINT ["python","manage.py", "runserver","0.0.0.0:8000"]